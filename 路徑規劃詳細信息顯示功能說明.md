# 路徑規劃詳細信息顯示功能說明

## 🎯 功能需求

用戶要求點擊路徑規劃圖層清單的項目時，在右側面板（PropertiesTab）顯示詳細信息，包括：

- 每個路徑點的經緯度
- 各項屬性信息
- 路線的完整詳細信息

## 🔧 技術實現

### 1. 新增計算屬性 ✅

#### 路徑規劃物件檢測

```javascript
/**
 * 🛣️ 是否為路徑規劃圖層物件 (Is Route Planning Layer Object)
 */
const isRoutePlanningObject = computed(() => {
  return selectedFeature.value?.properties?.layerId === 'route-planning-layer';
});

/**
 * 🛣️ 是否為路徑規劃路線 (Is Route Planning Line)
 */
const isRoutePlanningLine = computed(() => {
  return (
    isRoutePlanningObject.value &&
    selectedFeature.value?.properties?.type === 'route-line'
  );
});

/**
 * 📍 是否為路徑規劃點 (Is Route Planning Point)
 */
const isRoutePlanningPoint = computed(() => {
  return (
    isRoutePlanningObject.value &&
    selectedFeature.value?.properties?.type === 'route-planning-point'
  );
});
```

#### 路線詳細信息計算

```javascript
/**
 * 📍 路徑規劃路線詳細信息 (Route Planning Line Details)
 */
const routePlanningDetails = computed(() => {
  if (!isRoutePlanningLine.value) return null;

  const routeFeature = selectedFeature.value;
  const routeId = routeFeature.properties.id;
  const routeNumber = routeFeature.properties.routeNumber;

  // 從圖層中找到關聯的路徑點
  const routePlanningLayer = dataStore.findLayerById('route-planning-layer');
  if (!routePlanningLayer) return null;

  const relatedPoints = routePlanningLayer.geoJsonData.features
    .filter(
      (f) =>
        f.properties.type === 'route-planning-point' &&
        f.properties.routeId === routeId
    )
    .sort((a, b) => a.properties.order - b.properties.order);

  return {
    routeInfo: {
      id: routeId,
      name: routeFeature.properties.name,
      routeNumber: routeNumber,
      distance: routeFeature.properties.distance,
      duration: routeFeature.properties.duration,
      profile: routeFeature.properties.profile,
      waypoints: routeFeature.properties.waypoints,
      startPointName: routeFeature.properties.startPointName,
      endPointName: routeFeature.properties.endPointName,
      createdAt: routeFeature.properties.createdAt,
    },
    routePoints: relatedPoints.map((point) => ({
      order: point.properties.order,
      name: point.properties.name,
      latitude: point.properties.latitude,
      longitude: point.properties.longitude,
      coordinates: point.geometry.coordinates,
      createdAt: point.properties.createdAt,
    })),
  };
});
```

### 2. 模板顯示實現 ✅

#### 路線詳細信息顯示

```html
<!-- 🛣️ 路徑規劃路線專用：路線詳細信息 -->
<template v-if="isRoutePlanningLine && routePlanningDetails">
  <hr class="my-3" />

  <!-- 路線基本信息 -->
  <div class="my-title-xs-gray mb-3">路線信息</div>
  <DetailItem label="路線名稱" :value="routePlanningDetails.routeInfo.name" />
  <DetailItem
    label="路線編號"
    :value="`路線 ${routePlanningDetails.routeInfo.routeNumber}`"
  />
  <DetailItem
    label="總距離"
    :value="`${routePlanningDetails.routeInfo.distance} 公里`"
  />
  <DetailItem
    label="預估時間"
    :value="`${routePlanningDetails.routeInfo.duration} 分鐘`"
  />
  <DetailItem
    label="交通方式"
    :value="routePlanningDetails.routeInfo.profile === 'driving-car' ? '駕車' : routePlanningDetails.routeInfo.profile"
  />
  <DetailItem
    label="路徑點數"
    :value="`${routePlanningDetails.routeInfo.waypoints} 個`"
  />
  <DetailItem
    label="起點"
    :value="routePlanningDetails.routeInfo.startPointName"
  />
  <DetailItem
    label="終點"
    :value="routePlanningDetails.routeInfo.endPointName"
  />
  <DetailItem
    label="建立時間"
    :value="formatDateTime(routePlanningDetails.routeInfo.createdAt)"
  />

  <!-- 路徑點詳細清單 -->
  <template v-if="routePlanningDetails.routePoints.length > 0">
    <hr class="my-3" />

    <div class="my-title-xs-gray mb-3">
      路徑點詳細 {{ routePlanningDetails.routePoints.length }}
    </div>

    <div
      v-for="(point, index) in routePlanningDetails.routePoints"
      :key="index"
      class="mb-3 p-2 border rounded"
    >
      <div class="my-content-sm-black fw-bold mb-2">{{ point.name }}</div>
      <DetailItem label="順序" :value="`第 ${point.order} 個路徑點`" />
      <DetailItem label="緯度" :value="point.latitude.toFixed(6)" />
      <DetailItem label="經度" :value="point.longitude.toFixed(6)" />
      <DetailItem
        label="坐標"
        :value="`[${point.coordinates[0].toFixed(6)}, ${point.coordinates[1].toFixed(6)}]`"
      />
      <DetailItem label="建立時間" :value="formatDateTime(point.createdAt)" />
    </div>
  </template>
</template>
```

#### 路徑點詳細信息顯示

```html
<!-- 📍 路徑規劃點專用：路徑點詳細信息 -->
<template v-if="isRoutePlanningPoint">
  <hr class="my-3" />

  <!-- 路徑點基本信息 -->
  <div class="my-title-xs-gray mb-3">路徑點信息</div>
  <DetailItem label="點名稱" :value="selectedFeature.properties.name" />
  <DetailItem
    label="順序"
    :value="`第 ${selectedFeature.properties.order} 個路徑點`"
  />
  <DetailItem
    label="狀態"
    :value="selectedFeature.properties.status === 'completed' ? '已完成' : '規劃中'"
  />

  <!-- 已完成路徑點的額外信息 -->
  <template v-if="selectedFeature.properties.status === 'completed'">
    <DetailItem
      label="所屬路線"
      :value="`路線 ${selectedFeature.properties.routeNumber}`"
    />
    <DetailItem label="路線ID" :value="selectedFeature.properties.routeId" />
  </template>

  <!-- 坐標信息 -->
  <hr class="my-3" />
  <div class="my-title-xs-gray mb-3">坐標信息</div>
  <DetailItem
    label="緯度"
    :value="selectedFeature.properties.latitude?.toFixed(6) || 'N/A'"
  />
  <DetailItem
    label="經度"
    :value="selectedFeature.properties.longitude?.toFixed(6) || 'N/A'"
  />
  <DetailItem
    label="GeoJSON坐標"
    :value="`[${selectedFeature.geometry.coordinates[0].toFixed(6)}, ${selectedFeature.geometry.coordinates[1].toFixed(6)}]`"
  />

  <!-- 其他屬性 -->
  <hr class="my-3" />
  <div class="my-title-xs-gray mb-3">其他屬性</div>
  <DetailItem label="要素ID" :value="selectedFeature.properties.id" />
  <DetailItem label="圖層ID" :value="selectedFeature.properties.layerId" />
  <DetailItem label="要素類型" :value="selectedFeature.properties.type" />
  <DetailItem
    label="建立時間"
    :value="formatDateTime(selectedFeature.properties.createdAt)"
  />
</template>
```

## 📊 顯示的詳細信息

### 1. 路線信息 (點擊橘色路線時)

#### 基本信息

- **路線名稱**: 路線 1, 路線 2, ...
- **路線編號**: 自動生成的序號
- **總距離**: 5.23 公里 (來自 ORS API)
- **預估時間**: 18 分鐘 (來自 ORS API)
- **交通方式**: 駕車 (driving-car)
- **路徑點數**: 4 個
- **起點**: 路徑點 1
- **終點**: 路徑點 4
- **建立時間**: 2024/1/15 上午10:30:00

#### 關聯路徑點詳細清單

每個路徑點顯示：

```
路徑點 1
├─ 順序: 第 1 個路徑點
├─ 緯度: 25.033000
├─ 經度: 121.565400
├─ 坐標: [121.565400, 25.033000]
└─ 建立時間: 2024/1/15 上午10:30:00

路徑點 2
├─ 順序: 第 2 個路徑點
├─ 緯度: 25.035000
├─ 經度: 121.570000
├─ 坐標: [121.570000, 25.035000]
└─ 建立時間: 2024/1/15 上午10:30:05
```

### 2. 路徑點信息 (點擊路徑點時)

#### 基本信息

- **點名稱**: 路徑點 1
- **順序**: 第 1 個路徑點
- **狀態**: 已完成 / 規劃中

#### 已完成路徑點的額外信息

- **所屬路線**: 路線 1
- **路線ID**: route_1640995200000_abc123

#### 坐標信息

- **緯度**: 25.033000 (精確到6位小數)
- **經度**: 121.565400 (精確到6位小數)
- **GeoJSON坐標**: [121.565400, 25.033000]

#### 其他屬性

- **要素ID**: route_point_1640995200000_def456
- **圖層ID**: route-planning-layer
- **要素類型**: route-planning-point
- **建立時間**: 2024/1/15 上午10:30:00

## 🎯 使用方法

### 1. 查看路線詳細信息

```
1. 在地圖上點擊橘色路線
2. 右側面板自動顯示路線詳細信息
3. 包含路線基本信息和所有關聯路徑點的詳細信息
```

### 2. 查看路徑點詳細信息

```
1. 在地圖上點擊路徑點 (橘色或灰色圓圈)
2. 右側面板自動顯示路徑點詳細信息
3. 包含坐標、狀態、所屬路線等完整信息
```

### 3. 查看表格項目詳細信息

```
1. 在 DataTableTab 中點擊路徑規劃表格的任一行
2. 系統自動選中對應的地圖要素
3. 右側面板顯示對應的詳細信息
```

## 🔄 數據關聯

### 路線與路徑點的關聯機制

```javascript
// 路線數據結構
{
  properties: {
    id: 'route_1640995200000_abc123',     // 路線ID
    routeNumber: 1,                       // 路線編號
    type: 'route-line',
    // ... 其他路線屬性
  }
}

// 關聯的路徑點數據結構
{
  properties: {
    id: 'route_point_1640995200000_def456',  // 路徑點ID
    type: 'route-planning-point',
    status: 'completed',                     // 已完成狀態
    routeId: 'route_1640995200000_abc123',   // 關聯的路線ID
    routeNumber: 1,                          // 關聯的路線編號
    order: 1,                                // 在路線中的順序
    // ... 其他路徑點屬性
  }
}
```

### 關聯查詢邏輯

```javascript
// 根據路線ID查找關聯的路徑點
const relatedPoints = routePlanningLayer.geoJsonData.features
  .filter(
    (f) =>
      f.properties.type === 'route-planning-point' &&
      f.properties.routeId === routeId
  )
  .sort((a, b) => a.properties.order - b.properties.order);
```

## ✅ 功能特點

### ✅ 已實現功能

- ✅ **路線詳細信息**: 點擊路線顯示完整的路線信息
- ✅ **路徑點詳細信息**: 點擊路徑點顯示詳細的點信息
- ✅ **坐標精確顯示**: 經緯度精確到6位小數
- ✅ **狀態區分**: 清楚顯示規劃中/已完成狀態
- ✅ **關聯信息**: 顯示路徑點與路線的關聯關係
- ✅ **時間格式化**: 友善的時間顯示格式
- ✅ **完整屬性**: 顯示所有相關的技術屬性
- ✅ **分組顯示**: 信息按類別分組顯示
- ✅ **響應式更新**: 點擊不同物件自動更新顯示

### 🎨 視覺設計

- **分隔線**: 使用 `<hr>` 分隔不同信息區塊
- **標題樣式**: 使用 `my-title-xs-gray` 作為區塊標題
- **邊框卡片**: 路徑點詳細信息使用邊框卡片樣式
- **粗體名稱**: 路徑點名稱使用粗體顯示
- **統一格式**: 所有信息使用 `DetailItem` 組件統一格式

## 🚀 使用範例

### 查看路線 1 的詳細信息

```
點擊地圖上的路線 1 (橘色路線) →

右側面板顯示:
┌─ 路線信息 ─────────────────┐
│ 路線名稱: 路線 1           │
│ 路線編號: 路線 1           │
│ 總距離: 5.23 公里          │
│ 預估時間: 18 分鐘          │
│ 交通方式: 駕車             │
│ 路徑點數: 4 個             │
│ 起點: 路徑點 1             │
│ 終點: 路徑點 4             │
│ 建立時間: 2024/1/15 10:30  │
├─ 路徑點詳細 4 ─────────────┤
│ ┌─ 路徑點 1 ─────────────┐ │
│ │ 順序: 第 1 個路徑點     │ │
│ │ 緯度: 25.033000        │ │
│ │ 經度: 121.565400       │ │
│ │ 坐標: [121.565400, ... │ │
│ │ 建立時間: 2024/1/15... │ │
│ └─────────────────────── │ │
│ ┌─ 路徑點 2 ─────────────┐ │
│ │ ... (類似格式)         │ │
│ └─────────────────────── │ │
└───────────────────────────┘
```

### 查看路徑點的詳細信息

```
點擊地圖上的路徑點 1 (灰色圓圈) →

右側面板顯示:
┌─ 路徑點信息 ───────────────┐
│ 點名稱: 路徑點 1           │
│ 順序: 第 1 個路徑點        │
│ 狀態: 已完成               │
│ 所屬路線: 路線 1           │
│ 路線ID: route_1640...     │
├─ 坐標信息 ─────────────────┤
│ 緯度: 25.033000            │
│ 經度: 121.565400           │
│ GeoJSON坐標: [121.565...   │
├─ 其他屬性 ─────────────────┤
│ 要素ID: route_point_16...  │
│ 圖層ID: route-planning...  │
│ 要素類型: route-planning.. │
│ 建立時間: 2024/1/15 10:30  │
└───────────────────────────┘
```

---

_現在點擊路徑規劃圖層的任何項目（路線或路徑點）都會在右側面板顯示完整的詳細信息，包括精確的經緯度坐標和所有相關屬性。_
